from pyspark.sql import SparkSession

spark = SparkSession \
    .builder \
    .appName("Project #2") \
    .getOrCreate()
# spark is an existing SparkSession
stopwords = ["a", "about", "above", "after","again","against","all","am","an","and","any","are","aren't","as","at","be","because","been","before","being","below","between","both","but","by","can't","cannot","could","couldn't","did","didn't","do","does","doesn't","doing","don't","down","during","each","few","for","from","further","had","hadn't","has","hasn't","have","haven't","having","he","he'd","he'll","he's","her","here","here's","hers","herself","him","himself","his","how","how's","i","i'd","i'll","i'm","i've","if","in","into","is","isn't","it","it's","its","itself","let's","me","more","most","mustn't","my","myself","no","nor","not","of","off","on","once","only","or","other","ought","our","ours    ourselves","out","over","own","same","shan't","she","she'd","she'll","she's","should","shouldn't","so","some","such","than","that","that's","the","their","theirs","them","themselves","then","there","there's","these","they","they'd","they'll","they're","they've","this","those","through","to","too","under","until","up","very","was","wasn't","we","we'd","we'll","we're","we've","were","weren't","what","what's","when","when's","where","where's","which","while","who","who's","whom","why","why's","with","won't","would","wouldn't","you","you'd","you'll","you're","you've","your","yours","yourself","yourselves"];
#spanishstopwords = ["a","actualmente","adelante","además","afirmó","agregó","ahí","ahora","al","algo","algún","alguna","algunas","alguno","algunos","alrededor","ambos","ampleamos","añadió","ante","anterior","antes","apenas","aproximadamente","aquel","aquellas","aquellos","aqui","aquí","arriba","aseguró","así","atras","aún","aunque","ayer","bajo","bastante","bien","buen","buena","buenas","bueno","buenos","cada","casi","cerca","cierta","ciertas","cierto","ciertos","cinco","comentó","como","cómo","con","conocer","conseguimos","conseguir","considera","consideró","consigo","consigue","consiguen","consigues","contra","cosas","creo","cual","cuales","cualquier","cuando","cuanto","cuatro","cuenta","da","dado","dan","dar","de","debe","deben","debido","decir","dejó","del","demás","dentro","desde","después","dice","dicen","dicho","dieron","diferente","diferentes","dijeron","dijo","dio","donde","dos","durante","e","ejemplo","el","él","ella","ellas","ello","ellos","embargo","empleais","emplean","emplear","empleas","empleo","en","encima","encuentra","entonces","entre","era","eramos","eran","eras","eres","es","esa","esas","ese","eso","esos","esta","está","ésta","estaba","estaban","estado","estais","estamos","estan","están","estar","estará","estas","éstas","este","éste","esto","estos","éstos","estoy","estuvo","ex","existe","existen","explicó","expresó","fin","fue","fuera","fueron","fui","fuimos","gran","grandes","gueno","ha","haber","había","habían","habrá","hace","haceis","hacemos","hacen","hacer","hacerlo","haces","hacia","haciendo","hago","han","hasta","hay","haya","he","hecho","hemos","hicieron","hizo","hoy","hubo","igual","incluso","indicó","informó","intenta","intentais","intentamos","intentan","intentar","intentas","intento","ir","junto","la","lado","largo","las","le","les","llegó","lleva","llevar","lo","los","luego","lugar","manera","manifestó","más","mayor","me","mediante","mejor","mencionó","menos","mi","mientras","mio","misma","mismas","mismo","mismos","modo","momento","mucha","muchas","mucho","muchos","muy","nada","nadie","ni","ningún","ninguna","ningunas","ninguno","ningunos","no","nos","nosotras","nosotros","nuestra","nuestras","nuestro","nuestros","nueva","nuevas","nuevo","nuevos","nunca","o","ocho","otra","otras","otro","otros","para","parece","parte","partir","pasada","pasado","pero","pesar","poca","pocas","poco","pocos","podeis","podemos","poder","podrá","podrán","podria","podría","podriais","podriamos","podrian","podrían","podrias","poner","por","porqué","porque","posible","primer","primera","primero","primeros","principalmente","propia","propias","propio","propios","próximo","próximos","pudo","pueda","puede","pueden","puedo","pues","que","qué","quedó","queremos","quien","quién","quienes","quiere","realizado","realizar","realizó","respecto","sabe","sabeis","sabemos","saben","saber","sabes","se","sea","sean","según","segunda","segundo","seis","señaló","ser","será","serán","sería","si","sí","sido","siempre","siendo","siete","sigue","siguiente","sin","sino","sobre","sois","sola","solamente","solas","solo","sólo","solos","somos","son","soy","su","sus","tal","también","tampoco","tan","tanto","tendrá","tendrán","teneis","tenemos","tener","tenga","tengo","tenía","tenido","tercera","tiempo","tiene","tienen","toda","todas","todavía","todo","todos","total","trabaja","trabajais","trabajamos","trabajan","trabajar","trabajas","trabajo","tras","trata","través","tres","tuvo","tuyo","última","últimas","ultimo","último","últimos","un","una","unas","uno","unos","usa","usais","usamos","usan","usar","usas","uso","usted","va","vais","valor","vamos","van","varias","varios","vaya","veces","ver","verdad","verdadera","verdadero","vez","vosotras","vosotros","voy","y","ya","yo"]

def wordmapper(word):
    if(word not in stopwords and word not in spanishstopwords):
        (word, 1)

df = spark.read.json("/user/joanette_rosario/tweets1223anotherhour.json")
keywordtext = df.select('text')
count = keywordtext.flatMap(lambda line: line.lower().split())\
        .map(wordmapper())\
        .reduceByKey(lambda x, y: x+y)
count.top(10, lambda t: t[1])
